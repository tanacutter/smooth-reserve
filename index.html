<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>smooth reserve</title>
    <script src="https://unpkg.com/react@16/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@16/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/babel-standalone@6.15.0/babel.min.js"></script>
  </head>
  <body>
    <div id="root"></div>
    <script type="text/babel">
    // メニューを表示する
    class MenuDisplay extends React.Component {
      constructor(){
        super();
      }

      render(){
        return (
          <li className="menu">
            メニューを表示
          </li>
        );
      }
    }

    class NarrowDown extends React.Component {
      _narrowClick(narrowObj) {
        this.props.narrowClick(narrowObj);
      }

      render() {
        let narrows;
        narrows = [
          {
            id: 1,
            name: 'カット',
            type: 'cut'
          },
          {
            id: 2,
            name: 'カラー',
            type: 'color'
          },
          {
            id: 3,
            name: 'パーマ',
            type: 'permanent'
          }
        ];

        return(
          <ul>
            {
              narrows.map(function(narrow){
                  return (
                    <li key={narrow.id}>
                      <input type="checkbox" onClick={() => this._narrowClick(narrow)} />{narrow.name}
                    </li>
                  )
              }, this)
            }
          </ul>
        );
      }
    }

    // 表示するアイテム一覧を制御する
    class MenuList extends React.Component {
      render() {
        let selectedType = this.props.selectedType;
        let menus;
        menus = [
          {
            id: 1,
            name: 'カット',
            type: 'cut'
          },
          {
            id: 2,
            name: 'パーティーヘアセット',
            type: 'set'
          },
          {
            id: 3,
            name: 'オーガニックカラー',
            type: 'color'
          },
          {
            id: 4,
            name: 'イルミナリタッチカラー',
            type: 'color'
          },
          {
            id: 5,
            name: 'メンズカット',
            type: 'cut'
          },
          {
            id: 6,
            name: 'ナノケア縮毛矯正',
            type: 'permanent'
          },
          {
            id: 7,
            name: '前髪顔周り縮毛矯正',
            type: 'permanent'
          }
        ];

        return(
          <ul>
            {

              menus.map(function(menu){
                if (selectedType === '') {
                  return (
                    <li key={menu.id}>
                      {menu.name}
                    </li>
                    );
                } else {
                  if (menu.type === selectedType) {
                    return (
                      <li key={menu.id}>
                        {menu.name}
                      </li>
                    );
                  }
                }
              })

            }
          </ul>
        );
      }
    }

    // state管理
    class MenuApp extends React.Component {
      constructor() {
        super();
        this.state = {
          selectedMenu: [
            {id: 1, selected:false, name:''}
          ],
          type : ''
        };
        this.narrowType = this.narrowType.bind(this);
        this.narrowClick = this.narrowClick.bind(this);
      }

      narrowClick(narrowObj) {
        let selectedMenu = this.state.selectedMenu.slice();
        let foundFlg = 0;
        for (var i = 0; i<=this.state.selectedMenu.length - 1; i++) {
          if (this.state.selectedMenu[i].id === narrowObj.id) {
            selectedMenu[i] = {id:narrowObj.id, selected:this.state.selectedMenu[i].selected, name:narrowObj.name}
            this.setState({selectedMenu: selectedMenu});

            foundFlg === 1;
          }
        }

        if (foundFlg === 0) {
          this.setState({id:narrowObj.id, selected:true, name:narrowObj.item})
        }

      }

      // クリックを解除した時も見張っていく。
      narrowType(type) {
        // this.setState({type : this.state.type.concat({id: 'x', selected:true, item:''});
        this.setState({type : type});
      }

      render() {
        return (
          <div className="MenuPage">
            {this.state.type}
            <NarrowDown narrowClick={this.narrowClick} />
            <MenuList selectedType={this.state.type} />
          </div>
        );
      }

    }

    ReactDOM.render(
      <MenuApp />,
      document.getElementById('root')
    );

    </script>
  </body>
</html>
